\section{Гистограмма как оценка плотности распределения. Статистические
    свойства гистограммы. Теорема Пирсона. Критерий хи-квадрат для проверки
гипотезы о виде распределения генеральной совокупности}
%:: NOTE a:dzhiblavi
%:: NOTE check

\subsection{Построение}
Основной идеей, использующейся в этом методе, является идея \textit{группировки
данных}. Пусть распределение абсолютно непрерывно с непрерывной плотностью
распределения $f(x)$. Тогда значение плотности распределения в точке $t$
можно оценить как отношение вероятности попадания значния в полуинтервал
$\Delta = [t_1, t_2) \ni t$ к длине этого полуинтервала $t_2 - t_1 = |\Delta|$.
Иными словами:
\[
    f(t) \approx \frac{P(\Delta)}{|\Delta|}
.\]
Это приближение можно объяснить следующим образом, пользуясь теоремой Лагранжа:
\[
    P(\Delta) = \intl_{t_1}^{t_2}{f(x) \dd x} = f(t_1 + \theta |\Delta|) |\Delta|
    \approx f(t) |\Delta|
.\]
Построим наконец оценку, взяв в качестве $P(x < t_i) = F(t_i)$
выборочное значение:
\[
    P(\Delta) = F(t_2) - F(t_1) \approx F_n(t_2) - F_n(t_1) = k(\Delta)
.\]
За $k(\Delta)$ обозначим число элементов выборки, попавших в отрезок $\Delta$.

\begin{definition}
    \textit{Интервалами группировки} называется разбиение
    $\{\,\Delta_0, \Delta_{\pm 1}, \Delta_{\pm 2}, \ldots\,\}$ отрезка
    $[a, b]$ на дизъюнктные интервалы фиксированной длины $h > 0$.
\end{definition}

\begin{definition}
    \textit{Гистограммой} называется функция $f_n(t)$, принимающая
    постоянные значения на заданных интервалах группировки:
    \[
        t \in \Delta_m \Lra f_{n}(t) = f_{n, m} = \frac{k(\Delta_m)}{nh}
    .\]
\end{definition}

\begin{remark}
    Гистограмма -- кусочно постоянная функция.
\end{remark}

\begin{theorem}
    Гистограмма является плотностью распределения.
\end{theorem}
\begin{proof}
    $f_n(t) \geqslant 0$,
    \[
        \intl_{\R}{f_n(t) \dd t} = \sum_{m}{\intl_{\Delta_m}{f_{n}(t) \dd t}} =
        \sum_{m}{h f_{n, m}} = n^{-1} \sum_m{k(\Delta_m)} = 1
    .\]
\end{proof}

\begin{remark}
    На практике удобно выбирать границы $[a, b]$ в виде максимума и минимума
    элементов выборки.
\end{remark}

\subsection{Статиситические свойства гистограммы}
Гистограмма является оценкой плотности распределения. Изучим её свойства как
оценки. Для этого изучим квадратичное отклонение $R_{n, 2}(t)$. В нашем случае
$g(\theta) = f(t)$. Ранее было показано, что в случае одномерной оценки
квадратичный риск представим в виде
\[
    R_{n, 2}(t) = D_n(t) + b^2_n(t),~ D_n(t) = D_F(f_n(t)),
    b_n(t) = E_F(f_n(t)) - f(t)
.\]
Заметим, что при фиксированном $t$ $k(\Delta_m)$ -- случайная величина,
имеющая биномиальное распределение $k(\Delta_m) \sim B(n, p)$, $p = p_{n, m}
= P_F(\Delta_m)$. Отсюда имеем:
\[
    E_F(k(\Delta_m)) = np,~ D_F(k(\Delta_m)) = np(1 - p)
.\]
Вычислим на основе этих знаний значения сдвига и дисперсии:
\[
    b_n(t) = \parens*{\frac{p}{h} - f(t)},~ D_n(t) = \frac{p(1 - p)}{n h^2}
    \leqslant \frac{p}{h} \frac{1}{nh}
.\]
Имея непрерывность $f(x)$ на отрезке $\Delta_m$ по теорема Лагранжа имеем
\[
    \frac{p}{h} = \frac{1}{h_n} \intl_{\Delta_m}{f(x) \dd x} = f(\tilde{t}),~
    \tilde{t} \in \Delta_m
.\]
Отсюда при условях $h = h_n \to 0$, $nh_n \to +\infty$ следует:
\begin{align*}
    b_n(t) &= f(\tilde{t}) - f(t) \xrightarrow[n \to +\infty]{} 0 \\
    D_n(t) &= \frac{f(\tilde{t})}{nh} \xrightarrow[n \to +\infty]{} 0
.\end{align*}
Отсюда вытекает:
\[
    R_{n, 2}(t) \xrightarrow[n \to +\infty]{} 0
.\]
В этом случае по теореме о достаточном условии состоятельности оценки
следует

\begin{theorem}(Состоятельность гистограммы как оценки $f$)

    Пусть задано абсолютно непрерывное распределение с плотностью $f(x)$,
    отрезок $[a, b]$ и его разбиение с длинами интервалов $h_n$ такими,
    чтобы выполнялись условия:
    \[
        h_n \xrightarrow[n \to +\infty]{} 0,~ nh_n \xrightarrow[n \to +\infty]
        {} +\infty
    .\]
    Тогда соответствующая гистограмма является состоятельной оценкой плотности
    распределения.
\end{theorem}

\begin{theorem}
    Наилучшая скорость убывания длины интервалов группировки в классе плотностей
    с условием
    \[
        \exists C\colon~ \intl_\R{(f'(t))^2 \dd t} \leqslant C^2
    \]
    имеет порядок $n^{-1/3}$.
\end{theorem}

\subsection{Критерий хи-квадрат}

\subsubsection{Дискретная случайная величина}
Пусть генеральная совокупность $X$ -- дискретная случайная величина с
распределением $P_X(t = t_k) = p_k$, где $\overline{p}$ -- набор низвестных
вероятностей. Пусть решается вопрос о справедливости гипотезы
$p = \overline{p}_0 = (p_{0, 1}, p_{0, 2}, \ldots, p_{0, k})$, $p_{0, j} > 0$.
Через $\mathbb{P}$ обозначим множество:
\[
    \mathbb{P} = \{\,p \in \R^k \mid p_j \geqslant 0,~ \sum_j{p_j} = 1 \,\}
.\]
Поставим задачу проверки согласия с $H_0 \equiv \overline{p} = \overline{p}_0$.
Пусть $n_j$ -- число элементов выборки $X^{(n)}$, принимающих значение $t_j$,
$F_0(t)$ -- функция распределения генеральной совокупности при условии $H_0$.

%:: NOTE a:zagretdinov
%:: NOTE сумма разве не по k - 1?
%:: NOTE в позитинове -- нет
\begin{definition}
    \textit{Статистикой хи-квадрат с $k - 1$ степенью свободы} называется
    статистика
    \[
        \chi^2_{n, k - 1}(X^{(n)}) =
        \sum_{j = 1}^{k}{\frac{(n_j - n p_{0, j})^2}{np_{0, j}}}
    .\]
\end{definition}

\begin{definition}
    \textit{Функцией распределения хи-квадрат с $k$ степенями свободы}
    $\chi^2_{k}$ называется функция распределения случайной величины
    \[
        \tau_k = \sum_{i = 1}^k{\zeta^2_i},~ \zeta_i \sim N(0, 1)
    .\]
\end{definition}

\begin{theorem}(Пирсон)

    Пусть справедливо $\overline{p} = \overline{p}_0$. Тогда справедливо
    \[
        \sup_{u \in \R_{>0}}{\abs*{P_{F_0}\parens*{\chi^2_{n, k - 1} < u}
        - \chi^2_{k - 1}(u)}}
        \xrightarrow[n \to +\infty]{} 0
    .\]
\end{theorem}

\begin{definition}
    \textit{Критерием хи-квадрат} асимптотического уровня значимости $\a$
    для проверки согласия с гипотезой $H_0 \equiv \overline{p} = \overline{p}_0$
    называется последовательность тестов
    \[
        \psi_n(X^{(n)}) = \begin{cases}
            1,~ \chi^2_{n, k - 1} \geqslant t_{k - 1, \a} \\
            0,~ \chi^2_{n, k - 1} < t_{k - 1, \a}
        \end{cases}
    .\]
    Здесь величина $t_{k - 1, \a}$ определяется из условия
    \[
        \chi^2_{k - 1}(t_{k - 1, \a}) = 1 - \a
    .\]
\end{definition}

\begin{theorem}(Состоятельность критерия хи-квадрат)

    Критерий хи-квадрат является состоятельным критерием асимптотического
    уровня значимости $\a$.
\end{theorem}
\begin{proof}
    \enewline
    \begin{itemize}
        \item Оценим вероятность ошибки первого рода.
        %:: NOTE a:zagretdinov
        %:: NOTE \geqslant -> \textless надо, заменяешь одну вероятность на 1 - её же
            \[
                \a(\psi_n) = P_{n, F_0}(\chi^2_{n, k - 1} \geqslant
                t_{k - 1, \a}) = 1 - P_{n, F_0}(\chi^2_{n, k - 1} \geqslant
                t_{k - 1, \a}) \xrightarrow[n \to +\infty]{} 1 -
                \chi^2_{k - 1}(t_{k - 1, \a}) = \a
            .\]
            Таким образом, критерий имеет асимптотический уровень значимости
            $\a$.
        \item Оценим ошибку второго рода. Зафиксируем альтернативу
            $H_1 \equiv \overline{p} = \overline{p}_1 \neq \overline{p}_0$.
            Пусть $j_0\colon~ p_{1, j_0} \neq p_{0, j_0}$, $|p_{1, j_0}
            - p_{0, j_0}| = a$. В силу закона больших чисел $n_{j_0} / n
            \to p_{1, j_0}$ почти везде по мере $P_F$. Поэтому верно
            \[
                (n_{j_0} - np_{0, j_0})^2 \sim n^2a^2
            .\]
            Откуда по определению следует
            \[
                \chi^2_{n, k - 1} \xrightarrow[n \to +\infty]{} +\infty
            .\]
            Поэтому:
            %:: NOTE a:zagretdinov
            %:: NOTE почему это поэтому? поподробнее бы
            \[
                \b(\psi_n, F) = P_{n, F}(\chi^2_{n, k - 1} < t_{k - 1, \a})
                \xrightarrow[n \to +\infty]{} 0
            .\]
            Таким образом, критерий является состоятельным.
    \end{itemize}
\end{proof}

\subsubsection{Критерий хи-квадрат для случайной величины общего вида}
Рассмотрим теперь случайную величину общего вида. Пусть основная гипотеза
является простой и имеет вид $H_0 \equiv F_X(x) = F_0(x)$. Чтобы применить
критерий хи-квадрат к такой задаче, используют \textit{дискретизацию данных}.
Множество значений $X$ разбивается на $k$ множеств, попадание в каждое из
которых интерпретируется как значние дискретной случайной величины с $k$
значениями. Для этой случайной величины мы уже умеем применять критерий
хи-квадрат.
